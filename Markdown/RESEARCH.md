# Research

## Objectives

-   If I wanted to finetune a LM to generate text of a specific style/content, what good defaults would I choose?

-   Find best practices for finetuning tranformer language models for text generation.
-   Understand the "theory" of how language models can be finetuned
-   Present a finetuned LM that can generate coherent text across a range of domains
-   Understand the effect of model and dataset size on generating coherent text
-   Understand the effect of loss and sampling stategies on generating coherent text
-   Present the smallest and most resource efficient LM that can generate coherent text
-   The extent of language models needing to be large to generate coherent text

## Roadmap

-   get initial experiments done on distilgpt2
-   get more datasets
    -   I want a variety of styles, size, doc len, etc
-   do sampling research first

### Things to vary

-   context size
-   model size
-   model type
-   batch size
-   sampling strategy
    -   how to evaluate?

## What to try

-   datasets
    -   how do you train an lm when dataset is:
    -   large
    -   small
    -   custom
    -   well known
    -   specialized
    -   general
-   is pretraining a lm again ever needed?
    -   does finetuning give better results than grover, ctrl, etc
-   what is the best pretrained lm for text gen?
    -   best for widest range of text gen
    -   best for specific type of text gen (e.g. news, dialog)
-   effect of tokenizing approach (line by line, seq_len length chunks, lazy loading with random start point)
    -   might have an effect on efficiency
    -   lazy loading
        -   choose a random start point
        -   get 1k chars from that point
        -   tokenize and discard excess
-   long-form generation with sliding windows
    -   Try leaking data to the lm by training on contigous sequences (move the start position of input sequence 1 step up
-   pplm
    -   generalize pplm
        -   more attribute models for normal generation use
-   loss
    -   unlikelihood training
-   multiple datasets/control codes
    -   use control codes to train on a range of small (?) datasets
    -   is finetuning lm to work with control codes enough? or should it be pretrained with control codes too?

### For making finetuning more efficient

-   optimizers
    -   adagrad
    -   adafactor
-   pure fp16 training
-   Compare a small finetuned lm to a larger non-finetuned lm
-   how much worse is text generated by a non-finetuned lm?
-   based on a user's computation budget, should they finetune a small lm or use a large lm

### Theory of LMs

-   does a decrease in ppl lead to better text?
-   Can lms where train loss is close to 0 generate text well?
-   see if biases and layernorm should be finetuned
-   evaluation metrics
    -   any better evaluation metrics than ppl
    -   perplexity?
-   double descent
    -   finetune for a long time, does double descent happen when train loss is 0?
    -   anything special about generating text that makes double descent not a good choice?

### Hyperparameter tuning

-   learning rate decay strategies
-   warmup
-   effect of gpt-2's gelu and layernorm to inputs

## Finetuning Datasets

Some language models might have been pretrained on some of these datasets.

-   IMDB
-   AG News
-   Yahoo answers
-   Wikitext
    -   People train on raw data then normalize perplexity to match wikitext's tokenization
    -   Wikitext103
    -   Wikitext2
-   Penn Treebank
-   text8 (Cleaned version of enwiki8)
-   enwiki8 (Looks like this has all the XML? or not)
-   Project Gutenberg
-   Amazon reviews (McAuley et al, 2015)
-   CNN/Daily Mail (Hermann et al, 2015)
-   Bookscorpus (Aligning books and movies... Zhu et al, 2015)
-   One billion words
-   Yelp reviews (Character level convolutional networks... Zhang et al, 2015)
-   WritingsPrompts (Heiarchichal neural story generation. Fan et al 2018)
-   CC-Stories (Trinh and Lee 2018)
-   OpenWebText (Megatron LM version)
    -   openwebtext repo
    -   newspaper to download text
    -   langdetect to filter content
    -   ftfy for unicode normalization
    -   filter out docs under 128 tokens
    -   lsh to deduplicate content with jaccard similarity more than 0.7
    -   end of text token to end of document
    -   174 GB of text
-   Wikipedia (Devlin et al 2018)
-   PG-19 Language Modelling Benchmark

### Resources

-   https://course.fast.ai/datasets
-   https://paperswithcode.com/task/language-modelling
